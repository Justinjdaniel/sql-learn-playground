<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SQL Playground</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; margin: 2rem; }
      #editor { height: 200px; border: 1px solid #ccc; border-radius: 4px; }
      #run-button { margin-top: 10px; padding: 10px 15px; background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; font-size: 16px; }
      #run-button:hover { background-color: #0056b3; }
      #results { margin-top: 20px; }
      table { border-collapse: collapse; width: 100%; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
      th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
      th { background-color: #f8f9fa; }
      h1 { color: #333; }
    </style>
  </head>
  <body>
    <h1>SQL Playground ðŸš€</h1>
    <div id="editor"></div>
    <button id="run-button">Run Query</button>
    <div id="results"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.27.0/min/vs/loader.js"></script>
    <script>
      let db;
      async function initDb() {
        const SQL = await initSqlJs({
          locateFile: (file) =>
            `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/${file}`,
        });
        db = new SQL.Database();
        // Create tables and insert some data
        db.run("CREATE TABLE customers (id INT, name VARCHAR, email VARCHAR);");
        db.run(
          "INSERT INTO customers VALUES (1, 'John Smith', 'john.smith@example.com'), (2, 'Jane Doe', 'jane.doe@example.com'), (3, 'Peter Jones', 'peter.jones@example.com');"
        );
        db.run("CREATE TABLE orders (id INT, customer_id INT, amount REAL);");
        db.run(
          "INSERT INTO orders VALUES (1, 1, 100.50), (2, 1, 25.00), (3, 2, 75.25), (4, 3, 50.00);"
        );
      }
      initDb();

      let editor;
      require.config({
        paths: {
          vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.27.0/min/vs",
        },
      });
      require(["vs/editor/editor.main"], function () {
        editor = monaco.editor.create(document.getElementById("editor"), {
          value: "SELECT * FROM customers;",
          language: "sql",
        });
      });

      const runButton = document.getElementById("run-button");
      const resultsDiv = document.getElementById("results");

      runButton.addEventListener("click", () => {
        const query = editor.getValue();
        resultsDiv.innerHTML = ""; // Clear previous results
        try {
          const results = db.exec(query);
          if (results.length > 0) {
            results.forEach((result) => {
              const table = document.createElement("table");
              const thead = document.createElement("thead");
              const tbody = document.createElement("tbody");
              const headerRow = document.createElement("tr");
              result.columns.forEach((col) => {
                const th = document.createElement("th");
                th.textContent = col;
                headerRow.appendChild(th);
              });
              thead.appendChild(headerRow);
              result.values.forEach((row) => {
                const tr = document.createElement("tr");
                row.forEach((cell) => {
                  const td = document.createElement("td");
                  td.textContent = cell;
                  tr.appendChild(td);
                });
                tbody.appendChild(tr);
              });
              table.appendChild(thead);
              table.appendChild(tbody);
              resultsDiv.appendChild(table);
            });
          } else {
            resultsDiv.textContent =
              "Query executed successfully, but no results were returned.";
          }
        } catch (e) {
          resultsDiv.textContent = `Error: ${e.message}`;
        }
      });
    </script>
  </body>
</html>
